<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        .controls {
            margin-bottom: 30px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        .hint-btn {
            background: #2196F3;
        }
        
        .hint-btn:hover {
            background: #1976D2;
        }
        
        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 50px);
            grid-template-rows: repeat(9, 50px);
            gap: 1px;
            justify-content: center;
            margin: 20px auto;
            padding: 10px;
            background: #333;
            border-radius: 5px;
        }
        
        .cell {
            width: 50px;
            height: 50px;
            border: none;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            background: white;
            box-sizing: border-box;
            outline: none;
        }
        
        /* 3x3 box background colors - checkerboard pattern */
        .cell.box-0 { background: #fff8e1; } /* light yellow */
        .cell.box-1 { background: #e3f2fd; } /* light blue */
        .cell.box-2 { background: #fff8e1; } /* light yellow */
        .cell.box-3 { background: #e3f2fd; } /* light blue */
        .cell.box-4 { background: #fff8e1; } /* light yellow */
        .cell.box-5 { background: #e3f2fd; } /* light blue */
        .cell.box-6 { background: #fff8e1; } /* light yellow */
        .cell.box-7 { background: #e3f2fd; } /* light blue */
        .cell.box-8 { background: #fff8e1; } /* light yellow */
        
        .cell.original {
            filter: brightness(0.85);
            color: #333;
            font-weight: bold;
        }
        
        .cell.valid {
            filter: brightness(0.7);
            box-shadow: 0 0 3px #4CAF50;
        }
        
        .cell.invalid {
            background: #ffcdd2 !important;
            box-shadow: 0 0 3px #f44336;
        }
        
        .cell.hint {
            box-shadow: 0 0 5px #ff9800;
            filter: brightness(0.9);
        }
        
        /* 3x3 box separators using grid gaps */
        .cell:nth-child(3n):not(:nth-child(9n)) {
            margin-right: 2px;
        }
        
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            margin-bottom: 2px;
        }
        
        .status {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .success {
            color: #4CAF50;
        }
        
        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sudoku Game</h1>
        
        <div class="controls">
            <button onclick="newGame('easy')">New Easy Game</button>
            <button onclick="newGame('medium')">New Medium Game</button>
            <button onclick="newGame('hard')">New Hard Game</button>
            <button class="hint-btn" onclick="getHint()">Get Hint</button>
        </div>
        
        <div class="sudoku-grid" id="sudoku-grid">
            {% for i in range(9) %}
                {% for j in range(9) %}
                    {% set box_id = (i // 3) * 3 + (j // 3) %}
                    <input type="text" class="cell box-{{ box_id }} {% if original_cells[i][j] %}original{% endif %}" 
                           id="cell-{{ i }}-{{ j }}" 
                           data-row="{{ i }}" 
                           data-col="{{ j }}"
                           value="{% if board[i][j] != 0 %}{{ board[i][j] }}{% endif %}"
                           maxlength="1"
                           {% if original_cells[i][j] %}readonly{% endif %}>
                {% endfor %}
            {% endfor %}
        </div>
        
        <div class="status" id="status"></div>
    </div>

    <script>
        const cells = document.querySelectorAll('.cell:not(.original)');
        
        cells.forEach(cell => {
            cell.addEventListener('input', function(e) {
                const value = e.target.value;
                const row = parseInt(e.target.dataset.row);
                const col = parseInt(e.target.dataset.col);
                
                // Only allow digits 1-9 or empty
                if (value && (!/^[1-9]$/.test(value))) {
                    e.target.value = '';
                    return;
                }
                
                const num = value ? parseInt(value) : 0;
                
                fetch('/make_move', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        row: row,
                        col: col,
                        num: num
                    })
                })
                .then(response => response.json())
                .then(data => {
                    const status = document.getElementById('status');
                    const row = parseInt(e.target.dataset.row);
                    const col = parseInt(e.target.dataset.col);
                    const boxId = Math.floor(row / 3) * 3 + Math.floor(col / 3);
                    
                    if (num === 0) {
                        e.target.className = `cell box-${boxId}`;
                        status.textContent = '';
                    } else if (data.valid) {
                        e.target.className = `cell box-${boxId} valid`;
                        if (data.complete) {
                            status.innerHTML = '<span class="success">ðŸŽ‰ Congratulations! You solved the puzzle! ðŸŽ‰</span>';
                        } else {
                            status.textContent = '';
                        }
                    } else {
                        e.target.className = `cell box-${boxId} invalid`;
                        status.innerHTML = '<span class="error">Invalid move! Try again.</span>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
        
        function newGame(difficulty) {
            fetch(`/new_game/${difficulty}`)
                .then(response => response.json())
                .then(data => {
                    const grid = document.getElementById('sudoku-grid');
                    grid.innerHTML = '';
                    
                    for (let i = 0; i < 9; i++) {
                        for (let j = 0; j < 9; j++) {
                            const cell = document.createElement('input');
                            cell.type = 'text';
                            const boxId = Math.floor(i / 3) * 3 + Math.floor(j / 3);
                            cell.className = `cell box-${boxId}` + (data.original_cells[i][j] ? ' original' : '');
                            cell.id = `cell-${i}-${j}`;
                            cell.dataset.row = i;
                            cell.dataset.col = j;
                            cell.maxLength = 1;
                            cell.value = data.board[i][j] !== 0 ? data.board[i][j] : '';
                            cell.readOnly = data.original_cells[i][j];
                            
                            if (!data.original_cells[i][j]) {
                                cell.addEventListener('input', function(e) {
                                    const value = e.target.value;
                                    const row = parseInt(e.target.dataset.row);
                                    const col = parseInt(e.target.dataset.col);
                                    
                                    if (value && (!/^[1-9]$/.test(value))) {
                                        e.target.value = '';
                                        return;
                                    }
                                    
                                    const num = value ? parseInt(value) : 0;
                                    
                                    fetch('/make_move', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            row: row,
                                            col: col,
                                            num: num
                                        })
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        const status = document.getElementById('status');
                                        
                                        const row = parseInt(e.target.dataset.row);
                                        const col = parseInt(e.target.dataset.col);
                                        const boxId = Math.floor(row / 3) * 3 + Math.floor(col / 3);
                                        
                                        if (num === 0) {
                                            e.target.className = `cell box-${boxId}`;
                                            status.textContent = '';
                                        } else if (data.valid) {
                                            e.target.className = `cell box-${boxId} valid`;
                                            if (data.complete) {
                                                status.innerHTML = '<span class="success">ðŸŽ‰ Congratulations! You solved the puzzle! ðŸŽ‰</span>';
                                            } else {
                                                status.textContent = '';
                                            }
                                        } else {
                                            e.target.className = `cell box-${boxId} invalid`;
                                            status.innerHTML = '<span class="error">Invalid move! Try again.</span>';
                                        }
                                    });
                                });
                            }
                            
                            grid.appendChild(cell);
                        }
                    }
                    
                    document.getElementById('status').textContent = `New ${difficulty} game started!`;
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        function getHint() {
            fetch('/get_hint')
                .then(response => response.json())
                .then(data => {
                    if (data.hint) {
                        const cell = document.getElementById(`cell-${data.hint.row}-${data.hint.col}`);
                        const boxId = Math.floor(data.hint.row / 3) * 3 + Math.floor(data.hint.col / 3);
                        cell.value = data.hint.num;
                        cell.className = `cell box-${boxId} hint`;
                        
                        // Trigger the move
                        fetch('/make_move', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                row: data.hint.row,
                                col: data.hint.col,
                                num: data.hint.num
                            })
                        })
                        .then(response => response.json())
                        .then(moveData => {
                            if (moveData.complete) {
                                document.getElementById('status').innerHTML = '<span class="success">ðŸŽ‰ Congratulations! You solved the puzzle! ðŸŽ‰</span>';
                            }
                        });
                        
                        document.getElementById('status').innerHTML = `<span class="success">Hint: ${data.hint.num} placed at row ${data.hint.row}, column ${data.hint.col}</span>`;
                    } else {
                        document.getElementById('status').innerHTML = '<span class="error">No hints available!</span>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
</body>
</html>